<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
        This file is autogenerated from formatstorageencryption.html.in
        Do not edit this file. Changes will be lost.
      -->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" type="text/css" href="main.css" />
    <link rel="SHORTCUT ICON" href="32favicon.png" />
    <title>libvirt: Storage volume encryption XML format</title>
    <meta name="description" content="libvirt, virtualization, virtualization API" />
  </head>
  <body>
    <div id="header">
      <div id="headerLogo"></div>
      <div id="headerSearch">
        <form action="search.php" enctype="application/x-www-form-urlencoded" method="get"><div>
            <input id="query" name="query" type="text" size="12" value="" />
            <input id="submit" name="submit" type="submit" value="Search" />
          </div></form>
      </div>
    </div>
    <div id="body">
      <div id="menu">
        <ul class="l0"><li>
            <div>
              <a title="Front page of the libvirt website" class="inactive" href="index.html">Home</a>
            </div>
          </li><li>
            <div>
              <a title="Details of new features and bugs fixed in each release" class="inactive" href="news.html">News</a>
            </div>
          </li><li>
            <div>
              <a title="Applications known to use libvirt" class="inactive" href="apps.html">Applications</a>
            </div>
          </li><li>
            <div>
              <a title="Get the latest source releases, binary builds and get access to the source repository" class="inactive" href="downloads.html">Downloads</a>
            </div>
          </li><li>
            <div>
              <a title="Information for users, administrators and developers" class="active" href="docs.html">Documentation</a>
              <ul class="l1"><li>
                  <div>
                    <a title="How to compile libvirt" class="inactive" href="compiling.html">Compiling</a>
                  </div>
                </li><li>
                  <div>
                    <a title="Information about deploying and using libvirt" class="inactive" href="deployment.html">Deployment</a>
                  </div>
                </li><li>
                  <div>
                    <a title="Overview of the logical subsystems in the libvirt API" class="inactive" href="intro.html">Architecture</a>
                  </div>
                </li><li>
                  <div>
                    <a title="Description of the XML formats used in libvirt" class="active" href="format.html">XML format</a>
                    <ul class="l2"><li>
                        <div>
                          <a title="The domain XML format" class="inactive" href="formatdomain.html">Domains</a>
                        </div>
                      </li><li>
                        <div>
                          <a title="The virtual network XML format" class="inactive" href="formatnetwork.html">Networks</a>
                        </div>
                      </li><li>
                        <div>
                          <a title="Network filter XML format" class="inactive" href="formatnwfilter.html">Network Filtering</a>
                        </div>
                      </li><li>
                        <div>
                          <a title="The storage pool and volume XML format" class="inactive" href="formatstorage.html">Storage</a>
                        </div>
                      </li><li>
                        <div>
                          <span class="active">Storage Encryption</span>
                        </div>
                      </li><li>
                        <div>
                          <a title="The driver capabilities XML format" class="inactive" href="formatcaps.html">Capabilities</a>
                        </div>
                      </li><li>
                        <div>
                          <a title="The domain capabilities XML format" class="inactive" href="formatdomaincaps.html">Domain capabilities</a>
                        </div>
                      </li><li>
                        <div>
                          <a title="The host device XML format" class="inactive" href="formatnode.html">Node Devices</a>
                        </div>
                      </li><li>
                        <div>
                          <a title="The secret XML format" class="inactive" href="formatsecret.html">Secrets</a>
                        </div>
                      </li><li>
                        <div>
                          <a title="The snapshot XML format" class="inactive" href="formatsnapshot.html">Snapshots</a>
                        </div>
                      </li></ul>
                  </div>
                </li><li>
                  <div>
                    <a title="Hypervisor specific driver information" class="inactive" href="drivers.html">Drivers</a>
                  </div>
                </li><li>
                  <div>
                    <a title="Reference manual for the C public API" class="inactive" href="html/index.html">API reference</a>
                  </div>
                </li><li>
                  <div>
                    <a title="Bindings of the libvirt API for other languages" class="inactive" href="bindings.html">Language bindings</a>
                  </div>
                </li><li>
                  <div>
                    <a title="Working on the internals of libvirt API, driver and daemon code" class="inactive" href="internals.html">Internals</a>
                  </div>
                </li><li>
                  <div>
                    <a title="A guide and reference for developing with libvirt" class="inactive" href="devguide.html">Development Guide</a>
                  </div>
                </li><li>
                  <div>
                    <a title="Command reference for virsh" class="inactive" href="virshcmdref.html">Virsh Commands</a>
                  </div>
                </li><li>
                  <div>
                    <a title="Project governance and code of conduct" class="inactive" href="governance.html">Governance</a>
                  </div>
                </li></ul>
            </div>
          </li><li>
            <div>
              <a title="User contributed content" class="inactive" href="http://wiki.libvirt.org">Wiki</a>
            </div>
          </li><li>
            <div>
              <a title="Frequently asked questions" class="inactive" href="http://wiki.libvirt.org/page/FAQ">FAQ</a>
            </div>
          </li><li>
            <div>
              <a title="How and where to report bugs and request features" class="inactive" href="bugs.html">Bug reports</a>
            </div>
          </li><li>
            <div>
              <a title="How to contact the developers via email and IRC" class="inactive" href="contact.html">Contact</a>
            </div>
          </li><li>
            <div>
              <a title="Available test suites for libvirt" class="inactive" href="testsuites.html">Test suites</a>
            </div>
          </li><li>
            <div>
              <a title="Miscellaneous links of interest related to libvirt" class="inactive" href="relatedlinks.html">Related Links</a>
            </div>
          </li><li>
            <div>
              <a title="Overview of all content on the website" class="inactive" href="sitemap.html">Sitemap</a>
            </div>
          </li></ul>
      </div>
      <div id="content">
        <h1>Storage volume encryption XML format</h1>
        <ul><li>
            <a href="#StorageEncryption">Storage volume encryption XML</a>
            <ul><li>
                <a href="#StorageEncryptionDefault">"default" format</a>
              </li><li>
                <a href="#StorageEncryptionQcow">"qcow" format</a>
              </li><li>
                <a href="#StorageEncryptionLuks">"luks" format</a>
              </li></ul>
          </li><li>
            <a href="#example">Examples</a>
          </li></ul>
        <h2>
          <a name="StorageEncryption" shape="rect" id="StorageEncryption">Storage volume encryption XML</a>
          <a class="headerlink" href="#StorageEncryption" title="Permalink to this headline">¶</a>
        </h2>
        <p>
      Storage volumes may be encrypted, the XML snippet described below is used
      to represent the details of the encryption.  It can be used as a part
      of a domain or storage configuration.
    </p>
        <p>
      The top-level tag of volume encryption specification
      is <code>encryption</code>, with a mandatory
      attribute <code>format</code>.  Currently defined values
      of <code>format</code> are <code>default</code> and <code>qcow</code>.
      Each value of <code>format</code> implies some expectations about the
      content of the <code>encryption</code> tag.  Other format values may be
      defined in the future.
    </p>
        <p>
      The <code>encryption</code> tag can currently contain a sequence of
      <code>secret</code> tags, each with mandatory attributes <code>type</code>
      and either <code>uuid</code> or <code>usage</code>
      (<span class="since">since 2.1.0</span>). The only currently defined
      value of <code>type</code> is <code>volume</code>. The
      <code>uuid</code> is "uuid" of the <code>secret</code> while
      <code>usage</code> is the "usage" subelement field.
      A secret value can be set in libvirt by the
      <a href="html/libvirt-libvirt-secret.html#virSecretSetValue" shape="rect">
      <code>virSecretSetValue</code></a> API. Alternatively, if supported
      by the particular volume format and driver, automatically generate a
      secret value at the time of volume creation, and store it using the
      specified <code>uuid</code>.
    </p>
        <h3>
          <a name="StorageEncryptionDefault" shape="rect" id="StorageEncryptionDefault">"default" format</a>
          <a class="headerlink" href="#StorageEncryptionDefault" title="Permalink to this headline">¶</a>
        </h3>
        <p>
      <code>&lt;encryption format="default"/&gt;</code> can be specified only
      when creating a qcow volume.  If the volume is successfully created, the
      encryption formats, parameters and secrets will be auto-generated by
      libvirt and the attached <code>encryption</code> tag will be updated.
      The unmodified contents of the <code>encryption</code> tag can be used
      in later operations with the volume, or when setting up a domain that
      uses the volume.
    </p>
        <h3>
          <a name="StorageEncryptionQcow" shape="rect" id="StorageEncryptionQcow">"qcow" format</a>
          <a class="headerlink" href="#StorageEncryptionQcow" title="Permalink to this headline">¶</a>
        </h3>
        <p>
      The <code>qcow</code> format specifies that the built-in encryption
      support in <code>qcow</code>- or <code>qcow2</code>-formatted volume
      images should be used.  A single
      <code>&lt;secret type='passphrase'&gt;</code> element is expected.  If
      the <code>secret</code> element is not present during volume creation,
      a secret is automatically generated and attached to the volume.
    </p>
        <h3>
          <a name="StorageEncryptionLuks" shape="rect" id="StorageEncryptionLuks">"luks" format</a>
          <a class="headerlink" href="#StorageEncryptionLuks" title="Permalink to this headline">¶</a>
        </h3>
        <p>
      The <code>luks</code> format is specific to a luks encrypted volume
      and the secret is used in order to either encrypt during volume creation
      or decrypt the volume for usage by the domain. A single
      <code>&lt;secret type='passphrase'...&gt;</code> element is expected.
      <span class="since">Since 2.1.0</span>.
    </p>
        <p>
      For volume creation, it is possible to specify the encryption
      algorithm used to encrypt the luks volume. The following two
      optional elements may be provided for that purpose. It is hypervisor
      dependent as to which algorithms are supported. The default algorithm
      used by the storage driver backend when using qemu-img to create
      the volume is 'aes-256-cbc' using 'essiv' for initialization vector
      generation and 'sha256' hash algorithm for both the cipher and the
      initialization vector generation.
    </p>
        <dl><dt><code>cipher</code></dt><dd>This element describes the cipher algorithm to be used to either
          encrypt or decrypt the luks volume. This element has the following
          attributes:
          <dl><dt><code>name</code></dt><dd>The name of the cipher algorithm used for data encryption,
            such as 'aes', 'des', 'cast5', 'serpent', 'twofish', etc.
            Support of the specific algorithm is storage driver
            implementation dependent.</dd><dt><code>size</code></dt><dd>The size of the cipher in bits, such as '256', '192', '128',
            etc. Support of the specific size for a specific cipher is
            hypervisor dependent.</dd><dt><code>mode</code></dt><dd>An optional cipher algorithm mode such as 'cbc', 'xts',
            'ecb', etc. Support of the specific cipher mode is
            hypervisor dependent.</dd><dt><code>hash</code></dt><dd>An optional master key hash algorithm such as 'md5', 'sha1',
            'sha256', etc. Support of the specific hash algorithm is
            hypervisor dependent.</dd></dl>
      </dd><dt><code>ivgen</code></dt><dd>This optional element describes the initialization vector
          generation algorithm used in conjunction with the
          <code>cipher</code>. If the <code>cipher</code> is not provided,
          then an error will be generated by the parser.
          <dl><dt><code>name</code></dt><dd>The name of the algorithm, such as 'plain', 'plain64',
            'essiv', etc. Support of the specific algorithm is hypervisor
            dependent.</dd><dt><code>hash</code></dt><dd>An optional hash algorithm such as 'md5', 'sha1', 'sha256',
            etc. Support of the specific ivgen hash algorithm is hypervisor
            dependent.</dd></dl>
      </dd></dl>
        <h2>
          <a name="example" shape="rect" id="example">Examples</a>
          <a class="headerlink" href="#example" title="Permalink to this headline">¶</a>
        </h2>
        <p>
      Here is a simple example, specifying use of the <code>qcow</code> format:
    </p>
        <pre xml:space="preserve">
      &lt;encryption format='qcow'&gt;
         &lt;secret type='passphrase' uuid='c1f11a6d-8c5d-4a3e-ac7a-4e171c5e0d4a' /&gt;
      &lt;/encryption&gt;</pre>
        <p>
      Assuming a <a href="formatsecret.html#VolumeUsageType" shape="rect">
      <code>luks volume type secret</code></a> is already defined,
      a simple example specifying use of the <code>luks</code> format
      for either volume creation without a specific cipher being defined or
      as part of a domain volume definition:
    </p>
        <pre xml:space="preserve">
      &lt;encryption format='luks'&gt;
        &lt;secret type='passphrase' uuid='f52a81b2-424e-490c-823d-6bd4235bc572'/&gt;
      &lt;/encryption&gt;
    </pre>
        <p>
      Here is an example specifying use of the <code>luks</code> format for
      a specific cipher algorithm for volume creation:
    </p>
        <pre xml:space="preserve">
      &lt;volume&gt;
        &lt;name&gt;twofish.luks&lt;/name&gt;
        &lt;capacity unit='G'&gt;5&lt;/capacity&gt;
        &lt;target&gt;
          &lt;path&gt;/var/lib/libvirt/images/demo.luks&lt;/path&gt;
          &lt;format type='raw'/&gt;
          &lt;encryption format='luks'&gt;
             &lt;secret type='passphrase' uuid='f52a81b2-424e-490c-823d-6bd4235bc572'/&gt;
             &lt;cipher name='twofish' size='256' mode='cbc' hash='sha256'/&gt;
             &lt;ivgen name='plain64' hash='sha256'/&gt;
          &lt;/encryption&gt;
        &lt;/target&gt;
      &lt;/volume&gt;
    </pre>
      </div>
    </div>
  </body>
</html>
